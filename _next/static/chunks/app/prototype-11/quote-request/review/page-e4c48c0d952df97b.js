(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6596],{1591:(e,t,s)=>{Promise.resolve().then(s.bind(s,5678))},5678:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var r=s(5155),a=s(2115),i=s(5695),d=s(7123),l=s(4101),n=s(3642);function c(){var e;let t=(0,i.useRouter)(),{quoteRequest:s,updateQuoteRequest:c,setCurrentStep:o,clearQuoteRequest:m}=(0,d.o)(),[x,u]=(0,a.useState)(!1),[h,y]=(0,a.useState)(null),[p,g]=(0,a.useState)(s.selectedPlantId||""),[j,v]=(0,a.useState)(!1),[f,N]=(0,a.useState)(""),[b,k]=(0,a.useState)("info"),w=()=>{u(!0),N("Generating your quote..."),k("info"),v(!0),setTimeout(()=>{try{var e,t;let r=(0,l.uq)(p||s.selectedPlantId||"");if(!r){let e=(null==(t=s.products)?void 0:t.map(e=>"string"==typeof e.productId?e.productId:"prod-".concat(String(e.productId).padStart(3,"0"))))||[];r=l.Py.find(t=>e.every(e=>t.availableProducts.includes(e)))||l.Py[0]}let a=new Set((null==(e=s.products)?void 0:e.map(e=>{let t="string"==typeof e.productId?e.productId:"prod-".concat(String(e.productId).padStart(3,"0")),s=(0,l.y9)(t);return null==s?void 0:s.category}))||[]),i="";i=a.has("Concrete")?"truck-001":a.has("Steel")||a.has("Lumber")?"truck-003":"truck-002",r.availableTrucks.includes(i)||(i=r.availableTrucks[0]);let d=(0,l.Wd)(i);if(!d)throw Error("No suitable truck found");let n=(0,l.FU)(),{transportCost:c,tollFees:o,fuelSurcharge:m}=(0,l.Kv)(i,r.distance,n);console.log("Products in quoteRequest:",s.products);let x=(s.products||[]).map(e=>{console.log("Processing product item:",e);let t="string"==typeof e.productId?e.productId:"prod-".concat(String(e.productId).padStart(3,"0"));console.log("Formatted productId:",t);let s=(0,l.y9)(t);if(console.log("Found product:",s),!s)throw Error("Product not found: ".concat(t));let r=s.basePrice,a=e.quantity,i=new Date;return i.setDate(i.getDate()+3+Math.floor(3*Math.random())+Math.ceil(n.potentialDelay/24)),{product:s,quantity:a,unitPrice:r,totalPrice:r*a,availabilityDate:i,specialInstructions:e.specialInstructions}}),h=[];s.requestsSamples&&h.push({description:"Material samples",amount:75}),s.requestsConsultation&&h.push({description:"Consultation with material specialist",amount:150}),s.needsInstallation&&h.push({description:"Installation services (estimate)",amount:500});let g=new Date;g.setDate(g.getDate()+5+Math.floor(5*Math.random())+Math.ceil(n.potentialDelay/24));let j=x.reduce((e,t)=>e+t.totalPrice,0),f=c+o+m,b=h.reduce((e,t)=>e+t.amount,0),w=j+f+b,D=.0825*w,C=[];"low"!==n.riskLevel&&C.push({description:"Delay delivery until better weather conditions",costDifference:-(.15*c),timelineDifference:7}),j>5e3&&C.push({description:"Bulk order discount (10% off materials)",costDifference:-(.1*j),timelineDifference:0});let q={id:"QT-".concat(Date.now().toString(36).toUpperCase()),requestId:"RQ-".concat(Date.now().toString(36).toUpperCase()),dateCreated:new Date,expirationDate:s.expirationDate||new Date(Date.now()+2592e6),status:"pending",request:s,selectedPlant:r,products:x,delivery:{truck:d,estimatedDistance:r.distance,transportCost:c,estimatedDeliveryDate:g,weatherCondition:n,tollFees:o,fuelSurcharge:m},additionalCosts:h,subtotal:w,taxes:D,total:w+D,alternateOptions:C.length>0?C:void 0};y(q),u(!1),N("Your quote has been generated successfully!"),k("success"),v(!0)}catch(e){console.error("Error generating quote:",e),u(!1),N("There was an error generating your quote. Please try again."),k("error"),v(!0)}},3e3)};(0,a.useEffect)(()=>{h||x||w()},[]);let D=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),C=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e);return(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold mb-6",children:"Review Your Quote"}),x?(0,r.jsxs)("div",{className:"py-12 flex flex-col items-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-primary mb-4"}),(0,r.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"Generating your comprehensive quote..."}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:"This may take a few moments while we calculate pricing, check availability, and assess delivery options."})]}):h?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"bg-primary bg-opacity-10 dark:bg-opacity-20 p-6",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Quote #",h.id]}),(0,r.jsxs)("p",{className:"text-gray-500 dark:text-gray-400",children:["Created on ",D(h.dateCreated)]})]}),(0,r.jsx)("div",{className:"mt-4 md:mt-0",children:(0,r.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",children:["Valid until ",D(h.expirationDate)]})})]})}),(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Project Information"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-y-4 gap-x-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Project Name"}),(0,r.jsx)("p",{className:"font-medium",children:h.request.projectName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Sector"}),(0,r.jsx)("p",{className:"font-medium capitalize",children:h.request.sector})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Description"}),(0,r.jsx)("p",{children:h.request.projectDescription})]})]})]}),(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Materials"}),(0,r.jsx)("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{className:"text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:[(0,r.jsx)("th",{className:"px-4 py-3",children:"Product"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Unit Price"}),(0,r.jsx)("th",{className:"px-4 py-3",children:"Quantity"}),(0,r.jsx)("th",{className:"px-4 py-3 text-right",children:"Total"})]})}),(0,r.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:h.products.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsxs)("td",{className:"px-4 py-4",children:[(0,r.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.product.name}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.product.category," â€¢ ",e.product.description.substring(0,60),"..."]}),e.specialInstructions&&(0,r.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(0,r.jsx)("span",{className:"font-medium",children:"Note:"})," ",e.specialInstructions]})]}),(0,r.jsxs)("td",{className:"px-4 py-4",children:[C(e.unitPrice),"/",e.product.unitOfMeasure]}),(0,r.jsxs)("td",{className:"px-4 py-4",children:[e.quantity," ",e.product.unitOfMeasure]}),(0,r.jsx)("td",{className:"px-4 py-4 text-right font-medium",children:C(e.totalPrice)})]},t))})]})})]}),(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Delivery Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Plant Information"}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,r.jsx)("p",{className:"font-medium",children:h.selectedPlant.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.selectedPlant.location}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Distance: ",h.selectedPlant.distance.toFixed(1)," miles"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Delivery Address"}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,r.jsx)("p",{children:h.request.deliveryAddress.street}),(0,r.jsxs)("p",{children:[h.request.deliveryAddress.city,", ",h.request.deliveryAddress.state," ",h.request.deliveryAddress.zipCode]}),h.request.deliveryAddress.specialInstructions&&(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[(0,r.jsx)("span",{className:"font-medium",children:"Special Instructions:"})," ",h.request.deliveryAddress.specialInstructions]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Transportation"}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,r.jsx)("p",{className:"font-medium",children:h.delivery.truck.type}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.delivery.truck.description}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Capacity: ",h.delivery.truck.capacity," ",null==(e=h.products[0])?void 0:e.product.unitOfMeasure]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h5",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Delivery Timeline"}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[(0,r.jsxs)("p",{className:"text-sm",children:[(0,r.jsx)("span",{className:"font-medium",children:"Estimated Delivery:"})," ",D(h.delivery.estimatedDeliveryDate)]}),h.request.preferredDeliveryTimeWindow&&(0,r.jsxs)("p",{className:"text-sm mt-1",children:[(0,r.jsx)("span",{className:"font-medium",children:"Preferred Time:"}),h.request.preferredDeliveryTimeWindow.startHour,":00 -",h.request.preferredDeliveryTimeWindow.endHour,":00"]}),(0,r.jsxs)("div",{className:"mt-3 flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("svg",{className:"h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z",clipRule:"evenodd"})})}),(0,r.jsx)("p",{className:"ml-2 text-xs text-gray-500 dark:text-gray-400",children:"Delivery times may be affected by weather conditions and availability. You will be notified of any changes to the delivery schedule."})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsx)("h5",{className:"font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Weather Impact Assessment"}),(0,r.jsx)("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border-l-4 ".concat("low"===h.delivery.weatherCondition.riskLevel?"border-green-400":"medium"===h.delivery.weatherCondition.riskLevel?"border-yellow-400":"border-red-400"),children:(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsxs)("svg",{className:"h-5 w-5 ".concat("low"===h.delivery.weatherCondition.riskLevel?"text-green-400":"medium"===h.delivery.weatherCondition.riskLevel?"text-yellow-400":"text-red-400"),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:[(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 2a8 8 0 100 16 8 8 0 000-16zm0 14a6 6 0 110-12 6 6 0 010 12z",clipRule:"evenodd"}),(0,r.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"})]})}),(0,r.jsxs)("div",{className:"ml-3",children:[(0,r.jsxs)("h6",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[h.delivery.weatherCondition.condition.charAt(0).toUpperCase()+h.delivery.weatherCondition.condition.slice(1)," Conditions"]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:h.delivery.weatherCondition.description}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:[(0,r.jsx)("span",{className:"font-medium",children:"Potential Delay:"})," ",h.delivery.weatherCondition.potentialDelay," hours"]}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(0,r.jsx)("span",{className:"font-medium",children:"Risk Level:"})," ",h.delivery.weatherCondition.riskLevel.charAt(0).toUpperCase()+h.delivery.weatherCondition.riskLevel.slice(1)]})]})]})})]})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Quote Summary"}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Materials Subtotal"}),(0,r.jsx)("span",{className:"font-medium",children:C(h.products.reduce((e,t)=>e+t.totalPrice,0))})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Transportation Cost"}),(0,r.jsx)("span",{className:"font-medium",children:C(h.delivery.transportCost)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Toll Fees"}),(0,r.jsx)("span",{className:"font-medium",children:C(h.delivery.tollFees)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Fuel Surcharge"}),(0,r.jsx)("span",{className:"font-medium",children:C(h.delivery.fuelSurcharge)})]}),h.additionalCosts.length>0&&(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2 pt-2",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Additional Services"}),h.additionalCosts.map((e,t)=>(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:e.description}),(0,r.jsx)("span",{className:"font-medium",children:C(e.amount)})]},t))]})}),(0,r.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2 pt-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Subtotal"}),(0,r.jsx)("span",{className:"font-medium",children:C(h.subtotal)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:"Taxes (8.25%)"}),(0,r.jsx)("span",{className:"font-medium",children:C(h.taxes)})]})]}),(0,r.jsx)("div",{className:"border-t border-gray-200 dark:border-gray-700 my-2 pt-2",children:(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold",children:[(0,r.jsx)("span",{children:"Total"}),(0,r.jsx)("span",{children:C(h.total)})]})})]})]})]}),h.alternateOptions&&h.alternateOptions.length>0&&(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-6",children:[(0,r.jsx)("h4",{className:"text-lg font-medium mb-4",children:"Alternate Options"}),(0,r.jsx)("div",{className:"space-y-4",children:h.alternateOptions.map((e,t)=>(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700 p-4 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h5",{className:"font-medium text-gray-900 dark:text-white",children:["Option ",t+1,": ",e.description]}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:e.timelineDifference>0?"Adds ".concat(e.timelineDifference," days to delivery timeline"):e.timelineDifference<0?"Reduces delivery timeline by ".concat(Math.abs(e.timelineDifference)," days"):"No change to delivery timeline"})]}),(0,r.jsxs)("div",{className:"text-lg font-medium ".concat(e.costDifference<0?"text-green-500":"text-red-500"),children:[e.costDifference<0?"-":"+",C(Math.abs(e.costDifference))]})]}),(0,r.jsx)("div",{className:"mt-3 flex",children:(0,r.jsx)("button",{className:"text-sm text-primary hover:text-blue-600",children:"Request this option"})})]},t))})]}),(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between space-y-4 md:space-y-0",children:[(0,r.jsxs)("button",{type:"button",onClick:()=>{o(4),t.push("/prototype-11/quote-request/delivery")},className:"px-6 py-3 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center justify-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Delivery Information"]}),(0,r.jsxs)("div",{className:"flex space-x-4",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{m(),t.push("/prototype-11/")},className:"px-6 py-3 border border-primary text-primary hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",children:"Start New Quote"}),(0,r.jsx)("button",{type:"button",onClick:()=>{h&&(N("Quote accepted! Redirecting to order tracking..."),k("success"),v(!0),sessionStorage.setItem("acceptedQuoteId",h.id),setTimeout(()=>{t.push("/prototype-11/quote-request/tracking")},2e3))},className:"px-6 py-3 bg-primary hover:bg-blue-600 text-white rounded-lg transition-colors",children:"Accept Quote"})]})]})]}):(0,r.jsxs)("div",{className:"py-12 text-center",children:[(0,r.jsx)("p",{className:"text-lg text-gray-600 dark:text-gray-300",children:"An error occurred while generating your quote. Please try again."}),(0,r.jsx)("button",{onClick:w,className:"mt-4 px-6 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-colors",children:"Retry"})]}),j&&(0,r.jsx)(n.A,{message:f,type:b,isLoading:x,onClose:()=>v(!1)})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[4658,8441,1684,7358],()=>t(1591)),_N_E=e.O()}]);