"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6881],{3914:(e,t,o)=>{o.d(t,{dZ:()=>s});var s=function(e){return e.CUSTOMER_INFO="customer_info",e.PROJECT_INFO="project_info",e.MATERIAL_SELECTION="material_selection",e.DELIVERY_LOCATION="delivery_location",e.BUDGET="budget",e.PLANT_SELECTION="plant_selection",e.CONFIRMATION="confirmation",e}({})},6881:(e,t,o)=>{let s;o.d(t,{$:()=>c,b:()=>d});var n=o(5155),a=o(9543),r=o(2115),i=o(3914);class l{setQuoteRequest(e){this.quoteRequest={...this.quoteRequest,...e}}setCurrentQuestion(e){this.currentQuestion=e}setCurrentStepType(e){this.currentStepType=e}setIsLoading(e){this.isLoading=e}setQuoteComplete(e){this.quoteComplete=e}setUseClaudeAPI(e){this.useClaudeAPI=e}setRecommendedMaterials(e){this.recommendedMaterials=e}setRecommendedPlants(e){this.recommendedPlants=e}addToQuestionHistory(e){this.questionHistory.push(e)}goToPreviousQuestion(){if(0===this.questionHistory.length)return;let e=this.questionHistory.pop();e&&(this.currentStepType=e.stepType,this.currentQuestion=e.question)}completeQuote(){this.quoteComplete=!0;let e={...this.quoteRequest,id:this.generateQuoteId(),createdAt:new Date().toISOString(),status:"submitted"};this.quoteRequest=e,this.generatedQuotes.push(e);try{localStorage.setItem("generatedQuotes",JSON.stringify(this.generatedQuotes))}catch(e){console.warn("Error saving quote to local storage:",e)}}resetStore(){this.quoteRequest={status:"draft",exceedsBudget:!1,createdAt:new Date().toISOString(),materials:[],plantSelections:[],deliveryInfo:{location:{address:""}}},this.currentQuestion="What's your name and contact information?",this.currentStepType=i.dZ.CUSTOMER_INFO,this.quoteComplete=!1,this.questionHistory=[],this.recommendedMaterials=[],this.recommendedPlants=[]}processClaudeResponse(e){if(this.currentQuestion=e.question,this.quoteRequest.project){let t={},o=!1;if(e.quote_type){let s=this.quoteRequest.project.projectType;console.log('Updating quote type from API: "'.concat(s,'" -> "').concat(e.quote_type,'"')),t.projectType=e.quote_type,o=!0}e.project_summary&&!this.quoteRequest.project.summary&&(console.log('Adding project summary from API: "'.concat(e.project_summary,'"')),t.summary=e.project_summary,o=!0),o&&(this.quoteRequest.project={...this.quoteRequest.project,...t})}else e.quote_type&&this.currentStepType!==i.dZ.CUSTOMER_INFO&&console.log('Adding quote type from API: "'.concat(e.quote_type,'"'));this.quoteRequest.customer&&e.expertise_level&&this.currentStepType!==i.dZ.CUSTOMER_INFO&&this.quoteRequest.customer.expertiseLevel!==e.expertise_level&&(console.log('Updating expertise level from API: "'.concat(this.quoteRequest.customer.expertiseLevel,'" -> "').concat(e.expertise_level,'"')),this.quoteRequest.customer={...this.quoteRequest.customer,expertiseLevel:e.expertise_level});let t=e.componentType;if(Object.values(i.dZ).includes(t))this.currentStepType=t;else{let o=[i.dZ.CUSTOMER_INFO,i.dZ.PROJECT_INFO,i.dZ.MATERIAL_SELECTION,i.dZ.DELIVERY_LOCATION,i.dZ.BUDGET,i.dZ.PLANT_SELECTION,i.dZ.CONFIRMATION];switch(t){case"text":let s=o.indexOf(this.currentStepType);s>=0&&s<o.length-1?(this.currentStepType=o[s+1],console.log("Advancing to next step: ".concat(this.currentStepType))):(this.currentStepType=i.dZ.DELIVERY_LOCATION,console.warn("Could not determine next step from ".concat(this.currentStepType,", defaulting to ").concat(i.dZ.DELIVERY_LOCATION)));break;case"options":this.recommendedMaterials.length>0?this.currentStepType=i.dZ.MATERIAL_SELECTION:e.plants&&e.plants.length>0&&(this.currentStepType=i.dZ.PLANT_SELECTION);break;default:console.warn("Unknown component type: ".concat(t,", using current step type: ").concat(this.currentStepType))}}if(console.log("Mapped component type ".concat(t," to step type ").concat(this.currentStepType)),e.materials&&e.materials.length>0&&(this.recommendedMaterials=e.materials.map(e=>({id:e.id,name:e.name,category:e.category,unit:e.unit,basePrice:e.basePrice,description:e.description||"".concat(e.name," for construction projects"),commonUses:e.commonUses||["Construction"],recommendedQuantity:e.recommendedQuantity}))),e.plants&&e.plants.length>0){let t=e.plants.map((e,t)=>{var o,s,n,a,r,i,l;let u={id:e.id||"plant-".concat(t+1),name:e.name,location:{address:(null==(o=e.location)?void 0:o.address)||"".concat(e.name," location"),coordinates:(null==(s=e.location)?void 0:s.coordinates)||{lat:30.26+(Math.random()-.5)*2,lng:-97.74+(Math.random()-.5)*2}},materials:Array.isArray(e.materials)?e.materials:[{materialId:(null==(a=this.quoteRequest.materials)||null==(n=a[0])?void 0:n.materialId)||"default-material",availability:"high",priceMultiplier:1}],transportCostPerMile:e.transportCostPerMile||4.5,minDeliveryDistance:e.minDeliveryDistance||0,maxDeliveryDistance:e.maxDeliveryDistance||75,tollZones:e.tollZones||[]},c=0===t||1===t,d=["Cost-effective option for your materials","Closest supplier to your delivery location","Best availability for your requested materials","Specialized in the materials you need"],p=null==(i=this.quoteRequest.deliveryInfo)||null==(r=i.location)?void 0:r.coordinates,m=u.location.coordinates,h=30;if(p&&m){let e=Math.abs(p.lat-m.lat),t=Math.abs(p.lng-m.lng);h=Math.floor(69*Math.sqrt(e*e+t*t))}else h=Math.floor(20+80*Math.random());let q=h*u.transportCostPerMile;return{plant:u,materials:(null==(l=this.quoteRequest.materials)?void 0:l.map(e=>e.materialId))||[],distance:h,transportCost:q,isRecommended:c,reasonForRecommendation:c?d[Math.floor(Math.random()*d.length)]:void 0}});console.log("Plants from Claude API:",e.plants),console.log("Processed plant recommendations:",t),this.recommendedPlants=t}e.componentType===i.dZ.CONFIRMATION&&this.completeQuote(),e.costs&&this.updateCostFromClaudeResponse(e.costs)}updateCostFromClaudeResponse(e){var t;if(!e)return;let o=(this.quoteRequest.materials||[]).map(e=>{let t=this.recommendedMaterials.find(t=>t.id===e.materialId)||{name:e.materialId.replace(/-/g," "),basePrice:50},o=t.basePrice||50,s=o*e.quantity;return{materialId:e.materialId,name:t.name||e.materialId.replace(/-/g," ").split(" ").map(e=>e?e.charAt(0).toUpperCase()+e.slice(1):"").join(" "),quantity:e.quantity,unitCost:o,totalCost:s}}),s=(this.quoteRequest.plantSelections||[]).map((t,o)=>{var s,n,a;return{plantId:t.plantId,plantName:(null==(s=this.recommendedPlants[o])?void 0:s.plant.name)||"Plant ".concat(o+1),distance:(null==(n=this.recommendedPlants[o])?void 0:n.distance)||30,cost:(e.transport_cost||0)/Math.max(1,(null==(a=this.quoteRequest.plantSelections)?void 0:a.length)||1)}}),n=e.toll_cost||0,a=e.total_cost||(e.materials||0)+(e.transport_cost||0)+(e.toll_cost||0)+250,r=(null==(t=this.quoteRequest.deliveryInfo)?void 0:t.budget)!==void 0&&a>this.quoteRequest.deliveryInfo.budget;this.quoteRequest={...this.quoteRequest,costBreakdown:{materialCosts:o,transportationCosts:s,tollCosts:n,additionalFees:250,totalCost:a,exceedsBudget:r},exceedsBudget:r}}generateQuoteId(){let e=new Date().getTime().toString(36),t=Math.random().toString(36).substring(2,5);return"QR-".concat(e,"-").concat(t).toUpperCase()}constructor(){this.quoteRequest={status:"draft",exceedsBudget:!1,createdAt:new Date().toISOString(),materials:[],plantSelections:[],deliveryInfo:{location:{address:""}}},this.currentQuestion="What's your name and contact information?",this.currentStepType=i.dZ.CUSTOMER_INFO,this.isLoading=!1,this.quoteComplete=!1,this.useClaudeAPI=!0,this.questionHistory=[],this.recommendedMaterials=[],this.recommendedPlants=[],this.generatedQuotes=[],(0,a.l_)(this);try{let e=localStorage.getItem("generatedQuotes");e&&(this.generatedQuotes=JSON.parse(e))}catch(e){console.warn("Could not load quotes from local storage:",e)}}}let u=(0,r.createContext)(null);function c(){let e=(0,r.useContext)(u);if(!e)throw Error("useQuoteStore must be used within a QuoteStoreProvider");return e}function d(e){let{children:t}=e;return s||(s=new l),(0,n.jsx)(u.Provider,{value:s,children:t})}}}]);